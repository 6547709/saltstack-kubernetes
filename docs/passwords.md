# Passwords

---

## Kubernetes authentication token

Kubernetes tokens are used to authenticate users and services connected to the kube-apiserver

Use the following command line to generate an authentication token.

```bash
echo $(head -c 16 /dev/urandom | od -An -t x | tr -d ' ')
```

Record the value in the Salt pillar.

```yaml
kubernetes:
  master:
    token:
      admin: 3acb77307c903c780f341d5f0ae4a3b3
      kubelet: 56c5903a3cd445c5dfc302e4674ccc1a
      calico: 0b6c09902d7478220746cfe5605b9ef2
      kube_scheduler: fea3115c71d7fb87fd078978601474d7
      kube_controller_manager: 167945c664a88280d640ac45ff743ddb
      kube_proxy: 3606ab299c3e5ce37e834058eb7618fb
      bootstrap: 0d3bdadc181bdc504481195206314386
      monitoring: af41e9fef61d6a253152d53c9d9decc2
      logging: 45ceb5b4a0a82177aaadfcdabd51786f
      dns: a219bb8d953055339fde377a6ba6dd7c
```

## Kubernetes encryption keys

The Kubernetes encryption key is used to encrypt the data recorded in the etcd.

Use the following command line to generate the encryption key.

```bash
head -c 32 /dev/urandom | base64
```

Record the value in the Salt pillar.

```yaml
kubernetes:
  master:
    encryption-key: '9mmDipLv1QEjSzmNia/KyTl79aq6gCMWmqBsyk4P2Lc='
```

---

## Cert-Manager / Cloudflare API

Cloudflare registration email and Global API key is required to enable the DNS01 challenge management of Let's Encrypt by Cert-Manager.

Record the Cloudflare email and API key in the Salt pillar.

```yaml
kubernetes:
  addons:
    cert-manager:
        dns:
          provider: cloudflare
          email: admin@example.com
          secret: 012345abcde012345abcde012345abcde012345abcde
```

---

## Traefik Webui password

Use the following command line to generate the Traefik WebUI password.

```bash
echo $(htpasswd -nb admin Us3Y0ur0wnP4ssw0rd) | sed -e s/\\$/\\$\\$/g
```

Record the value next to `admin:` in the Salt pillar.

```yaml
kubernetes:
  addons:
    traefik:
      password: $$apr1$$u7.rXtVi$$DQtLfP6lJJZqvENhyo6EX1
```

---

## Rook Minio 

Minio object storage server use a combination of Access and Secret keys to authentication to its API and WebUI.

Use the following command line to generate Minio Access and Secret keys.

```bash
echo -n 'Th1515MyUs3rN4m3' | base64
echo -n 'Th1515MyUs3rP4ssw0rd' | base64
```

Record the Access key and Secret key as `username` and `password` in the Salt pillar.

```yaml
kubernetes:
  master:
    storage:
      minio_operator:
        username: VGgxNTE1TXlVczNyTjRtMw==
        password: VGgxNTE1TXlVczNyUDRzc3cwcmQ=
```

---

## Harbor secret key

Harbor registry use a secret key to authenticate to its API. 

Use the following command line to generate the Harbor secret key.

```bash
cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 16 | head -n 1
```

Record the value next in the Salt pillar.

> Notice that admin and database passwords are in clear-text.

```yaml
kubernetes:
  charts:
    harbor:
      secretkey: 2Ds7hlY9VHyKAcNd
      admin_password: Cl34r3T3xt
      database_password: Cl34r3T3xt
```

---

## Keycloak

Default `keycloak` admin account is automatically generated by the [Helm chart](https://github.com/helm/charts/tree/master/stable/keycloak) and store as a Secret in Kubernetes.

Use the following command line to retrieve the password using `kubectl`.

```bash
kubectl get secret --namespace keycloak keycloak-http -o jsonpath="{.data.password}" | base64 --decode; echo
```

---