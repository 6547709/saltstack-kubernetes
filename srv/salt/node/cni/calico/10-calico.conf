{%- set etcdCount = pillar['kubernetes']['etcd']['count'] -%}
{%- set etcd01ip =  pillar['kubernetes']['etcd']['cluster']['etcd01']['ipaddr'] -%}
{%- set etcd02ip =  pillar['kubernetes']['etcd']['cluster']['etcd02']['ipaddr'] -%} 
{%- set etcdO3ip =  pillar['kubernetes']['etcd']['cluster']['etcd03']['ipaddr'] -%} 

{%- set enableIPv6 = pillar['kubernetes']['node']['networking']['calico']['ipv6']['enable'] -%}
{% if enableIPv6 == true %}
	{%- set IPv6env = "true" -%}
{% else %}
	{%- set IPv6env = "false" -%}
{% endif %}
{
    "name": "calico-k8s-network",
    "type": "calico",
    "datastore_type": "etcdv3",
    "etcd_endpoints": "https://{{ etcd01ip }}:2379,https://{{ etcd02ip }}:2379,https://{{ etcd03ip }}:2379",
    "etcd_key_file": "/etc/kubernetes/ssl/node-key.pem",
    "etcd_cert_file": "/etc/kubernetes/ssl/node.pem",
    "etcd_ca_cert_file": "/etc/kubernetes/ssl/ca.pem",
    "ipam": {
        "type": "calico-ipam",
        "assign_ipv4": "true",
        "assign_ipv6": "{{ IPv6env }}"
    },
    "policy": {
        "type": "k8s"
    },
    "kubernetes": {
        "kubeconfig": "/etc/calico/kube/kubeconfig"
    }
}